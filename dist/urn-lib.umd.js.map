{"version":3,"file":"urn-lib.umd.js","sources":["../src/lib/validate.js","../src/lib/format.js","../src/lib/tokenize.js","../src/schemes/rfc2141.js","../src/main.js"],"sourcesContent":["export const RFC2141_NID_VALID = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890-';\n\nexport function isRfc2141NidString(str, strictMode) {\n  if (true === strictMode) {\n    if (!isString(str)) return false;\n    // https://www.ietf.org/rfc/rfc2141.txt Section 2.1\n    if (str.length < 1) {\n      return false;\n    }\n    if (str.length > 31) {\n      return false;\n    }\n    // To avoid confusion with the \"urn:\" identifier, the NID \"urn\" is\n    // reserved and MUST NOT be used.\n    if ('urn' === str.toLowerCase()) {\n      return false;\n    }\n  }\n  if (null === str) str = '';\n  else if (!isString(str)) return false;\n  if (str[0] === '-') return false;\n  for (let chr of str) {\n    if (RFC2141_NID_VALID.indexOf(chr) < 0) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function isString(str) {\n  return typeof str === 'string';\n}\n\nexport function isProtocol(protocol, parsed) {\n  let value = parsed.protocol;\n  if (!isString(value)) return false;\n  return protocol.toLowerCase() === value.toLowerCase();\n}\n\nexport function isValid(parsed, propertyName, allowZeroLength) {\n  let value = parsed[propertyName];\n  return parsed.hasOwnProperty(propertyName) && isString(value) && (allowZeroLength || value.length > 0);\n}\n\nexport function urnObject(protocol, customRules, allowZeroLength, parsed) {\n  let errors    = [];\n  Object.keys(parsed).forEach((propertyName, index) => {\n    if (!isValid(parsed, propertyName, allowZeroLength)) {\n      errors.push(`validation failed for ${propertyName}: invalid value`);\n    }\n  });\n  if (!isProtocol(protocol, parsed)) {\n    errors.push(`validation failed for protocol: expected ${protocol} but got ${parsed.protocol}`);\n  }\n  customRules.forEach(rule => {\n    let [propertyName,errorMessage,validator] = rule;\n    try {\n      let value = parsed[propertyName];\n      if (true !== validator(value)) {\n        errors.push(`validation failed for ${propertyName}: ${errorMessage}`);\n      }\n    }\n    catch(err) {\n      errors.push(`validation error for ${propertyName}: ${err.message}`);\n    }\n  });\n  return errors.length ? errors : null;\n}\n","import { isString } from './validate.js';\n\nexport default function(protocol, components, separator, parsed) {\n  protocol = parsed && parsed.hasOwnProperty('protocol') ? parsed.protocol : protocol;\n  if (!isString(protocol)) throw new Error('protocol is missing or invalid');\n  return protocol + separator + components.map(name => !isString(parsed[name]) ? '' : parsed[name]).join(separator);\n}\n","import { isString } from './validate.js';\n\nexport default function(components, separator, str) {\n  if (!Array.isArray(components) || components.length < 1) throw new Error('components not valid');\n  if (!isString(str)) return null;\n  let parts     = str.split(separator);\n  if (parts.length < 2) return null;\n  let protocol  = parts.shift(); // all schemes have a protocol\n  let parsed    = { protocol };\n  let len       = components.length - 1; // last component treated differently\n  for (let i=0; i < len; i++) {\n    let name = components[i];\n    parsed[name] = parts.length ? parts.shift() : null;\n  }\n  // concat last component.  anything beyond what's defined in components\n  // is a single string that belongs to last part\n  let lastPartName      = components[len];\n  parsed[lastPartName]  = parts.length ? parts.join(separator) : null;\n  return parsed;\n}\n","export const PREFIX = 'urn';\nexport const SEPARATOR = ':';\n\nexport const COMPONENTS = [\n  'nid',\n  'nss',\n];\n","import format from './lib/format.js';\nimport tokenize from './lib/tokenize.js';\nimport { urnObject, isRfc2141NidString } from './lib/validate.js';\nimport { PREFIX as RFC2141_PREFIX, SEPARATOR as RFC2141_SEPARATOR, COMPONENTS as RFC2141_COMPONENTS } from './schemes/rfc2141.js';\n\n// generates an array of rules that treats all but the last component\n// as an nid string (with limited valid charset)\nexport function generateDefaultValidationRules(components) {\n  let lastIndex = components.length - 1;\n  let nss = components[lastIndex];\n  let rules = [];\n  for (let i=0; i < lastIndex; i++) {\n    let name = components[i];\n    rules.push([ name, 'invalid characters', (value) => isRfc2141NidString(value, false) ]);\n  }\n  return rules;\n}\n\nfunction build(protocol, components, data) {\n  data = data || {};\n  let built = { protocol };\n  components.forEach(name => built[name] = data[name] || null);\n  return built;\n}\n\nexport function create(protocol, options) {\n  options = options || {};\n  let components        = options.components || RFC2141_COMPONENTS;\n  let allowEmpty        = options.hasOwnProperty('allowEmpty') ? options.allowEmpty : false;\n  let separator         = options.separator || RFC2141_SEPARATOR;\n  let validationRules   = options.validationRules || generateDefaultValidationRules(components);\n  return {\n    validate:   urnObject.bind(null, protocol, validationRules, allowEmpty),\n    format:     format.bind(null, protocol, components, separator),\n    parse:      tokenize.bind(null, components, separator),\n    build:      build.bind(null, protocol, components),\n  };\n}\n\nexport const RFC2141 = create(RFC2141_PREFIX, {\n  components:       RFC2141_COMPONENTS,\n  separator:        RFC2141_SEPARATOR,\n  allowEmpty:       false,\n});\n"],"names":["RFC2141_NID_VALID","isRfc2141NidString","str","strictMode","isString","length","toLowerCase","chr","indexOf","isProtocol","protocol","parsed","value","isValid","propertyName","allowZeroLength","hasOwnProperty","urnObject","customRules","errors","keys","forEach","index","push","rule","errorMessage","validator","err","message","components","separator","Error","map","name","join","Array","isArray","parts","split","shift","len","i","lastPartName","PREFIX","SEPARATOR","COMPONENTS","generateDefaultValidationRules","lastIndex","nss","rules","build","data","built","create","options","RFC2141_COMPONENTS","allowEmpty","RFC2141_SEPARATOR","validationRules","bind","format","tokenize","RFC2141","RFC2141_PREFIX"],"mappings":"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"}